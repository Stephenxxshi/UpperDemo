{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://plant01.com/schemas/channel-config.json",
  "title": "Channel Configuration",
  "description": "设备通信通道配置",
  "type": "object",
  "required": ["Code", "Name", "Enable", "Drive", "Devices"],
  "properties": {
    "Code": {
      "type": "string",
      "description": "通道唯一标识符",
      "minLength": 1,
      "maxLength": 50,
      "pattern": "^[A-Za-z0-9_-]+$"
    },
    "Name": {
      "type": "string",
      "description": "通道显示名称",
      "minLength": 1,
      "maxLength": 100
    },
    "Enable": {
      "type": "boolean",
      "description": "是否启用此通道",
      "default": true
    },
    "Description": {
      "type": "string",
      "description": "通道描述信息",
      "maxLength": 500
    },
    "Drive": {
      "type": "string",
      "description": "驱动类型",
      "enum": ["SiemensS7", "ModbusTcp", "Simulation"]
    },
    "DriveModel": {
      "type": "string",
      "description": "驱动型号 (如 S7_1200)"
    },
    "Devices": {
      "type": "array",
      "description": "此通道下的设备列表",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/device"
      }
    }
  },
  "$defs": {
    "device": {
      "type": "object",
      "required": ["Name", "Enable"],
      "properties": {
        "Name": {
          "type": "string",
          "description": "设备名称",
          "minLength": 1,
          "maxLength": 100
        },
        "Description": {
          "type": "string",
          "description": "设备描述",
          "maxLength": 500
        },
        "Enable": {
          "type": "boolean",
          "description": "是否启用此设备",
          "default": true
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "Drive": { "const": "SiemensS7" }
            }
          },
          "then": {
            "$ref": "#/$defs/siemensS7Device"
          }
        },
        {
          "if": {
            "properties": {
              "Drive": { "const": "ModbusTcp" }
            }
          },
          "then": {
            "$ref": "#/$defs/modbusTcpDevice"
          }
        }
      ]
    },
    "siemensS7Device": {
      "type": "object",
      "required": ["IpAddress", "Port"],
      "properties": {
        "IpAddress": {
          "type": "string",
          "description": "PLC IP 地址",
          "pattern": "^(\\d{1,3}\\.){3}\\d{1,3}$"
        },
        "Port": {
          "type": "integer",
          "description": "TCP 端口",
          "default": 102,
          "minimum": 1,
          "maximum": 65535
        },
        "Rack": {
          "type": "integer",
          "description": "机架号",
          "default": 0,
          "minimum": 0,
          "maximum": 7
        },
        "Slot": {
          "type": "integer",
          "description": "插槽号",
          "default": 1,
          "minimum": 0,
          "maximum": 31
        },
        "ScanRate": {
          "type": "integer",
          "description": "扫描速率 (毫秒)",
          "default": 100,
          "minimum": 10,
          "maximum": 10000
        },
        "ConnectTimeout": {
          "type": "integer",
          "description": "连接超时 (毫秒)",
          "default": 5000,
          "minimum": 1000,
          "maximum": 60000
        },
        "PlcModel": {
          "type": "string",
          "description": "PLC 型号",
          "enum": ["S7_200", "S7_300", "S7_400", "S7_1200", "S7_1500"],
          "default": "S7_1200"
        }
      }
    },
    "modbusTcpDevice": {
      "type": "object",
      "required": ["IpAddress", "Port"],
      "properties": {
        "IpAddress": {
          "type": "string",
          "description": "Modbus TCP 服务器 IP 地址",
          "pattern": "^(\\d{1,3}\\.){3}\\d{1,3}$"
        },
        "Port": {
          "type": "integer",
          "description": "TCP 端口",
          "default": 502,
          "minimum": 1,
          "maximum": 65535
        },
        "SlaveId": {
          "type": "integer",
          "description": "从站地址",
          "default": 1,
          "minimum": 1,
          "maximum": 247
        },
        "ScanRate": {
          "type": "integer",
          "description": "扫描速率 (毫秒)",
          "default": 100,
          "minimum": 10,
          "maximum": 10000
        },
        "ConnectTimeout": {
          "type": "integer",
          "description": "连接超时 (毫秒)",
          "default": 5000,
          "minimum": 1000,
          "maximum": 60000
        }
      }
    }
  }
}
